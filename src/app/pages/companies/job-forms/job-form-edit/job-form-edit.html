<div class="job-form-edit-container">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">
      {{ isEditMode ? 'ุชุนุฏูู ุงููููุฐุฌ' : 'ุฅูุดุงุก ูููุฐุฌ ุฌุฏูุฏ' }}
    </h1>
    <button class="btn btn-secondary" (click)="cancel()">ุฅูุบุงุก</button>
  </div>

  <!-- Loading Skeleton -->
  @if (loading) {
  <div class="skeleton-form">
    <p-skeleton width="100%" height="3rem" styleClass="mb-3"></p-skeleton>
    <p-skeleton width="100%" height="10rem" styleClass="mb-3"></p-skeleton>
    <p-skeleton width="100%" height="3rem" styleClass="mb-3"></p-skeleton>
  </div>
  }

  <!-- Form -->
  @if (!loading) {
  <form (ngSubmit)="onSubmit()" class="job-form-edit-form">
    <!-- Basic Information -->
    <div class="form-section">
      <h2 class="section-title">ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ</h2>

      <div class="form-group">
        <label for="name" class="form-label required">
          ุงุณู ุงููููุฐุฌ
        </label>
        <input
          pInputText
          type="text"
          id="name"
          name="name"
          [(ngModel)]="formData.name"
          required
          maxlength="200"
          placeholder="ูุซุงู: ูููุฐุฌ ุงูุชูุฏูู ูููุทูุฑูู"
          class="form-control"
        />
        <small class="form-hint">ุญุฏ ุฃูุตู 200 ุญุฑู</small>
      </div>

      <div class="form-group">
        <label for="description" class="form-label">
          ูุตู ุงููููุฐุฌ
        </label>
        <textarea
          pTextarea
          id="description"
          name="description"
          [(ngModel)]="formData.description"
          rows="4"
          placeholder="ูุตู ูุฎุชุตุฑ ุนู ุงููููุฐุฌ..."
          class="form-control"
        ></textarea>
      </div>

      <div class="form-group">
        <div class="checkbox-group">
          <p-checkbox
            [(ngModel)]="formData.is_active"
            [binary]="true"
            inputId="is_active"
            name="is_active"
          ></p-checkbox>
          <label for="is_active" class="checkbox-label">
            ุงููููุฐุฌ ูุดุท
          </label>
        </div>
        <small class="form-hint">ุงูููุงุฐุฌ ุงููุดุทุฉ ููุท ุณุชุธูุฑ ูููุชูุฏููู</small>
      </div>
    </div>

    <!-- Questions Section -->
    <div class="form-section">
      <div class="section-header">
        <h2 class="section-title">ุงูุฃุณุฆูุฉ</h2>
        <button
          type="button"
          class="btn btn-primary btn-sm"
          (click)="addQuestion()"
        >
          <span>+</span> ุฅุถุงูุฉ ุณุคุงู
        </button>
      </div>

      @if (questions.length === 0) {
      <div class="empty-questions">
        <p>ูุง ุชูุฌุฏ ุฃุณุฆูุฉ. ุงููุฑ ุนูู "ุฅุถุงูุฉ ุณุคุงู" ูุจุฏุก ุฅุถุงูุฉ ุงูุฃุณุฆูุฉ.</p>
      </div>
      }

      @for (question of questions; track questionIndex; let questionIndex = $index) {
      <div class="question-card">
        <div class="question-header">
          <span class="question-number">ุณุคุงู {{ questionIndex + 1 }}</span>
          <div class="question-actions">
            <button
              type="button"
              class="action-icon-btn"
              (click)="moveQuestionUp(questionIndex)"
              [disabled]="questionIndex === 0"
              title="ููู ูุฃุนูู"
            >
              โฌ๏ธ
            </button>
            <button
              type="button"
              class="action-icon-btn"
              (click)="moveQuestionDown(questionIndex)"
              [disabled]="questionIndex === questions.length - 1"
              title="ููู ูุฃุณูู"
            >
              โฌ๏ธ
            </button>
            <button
              type="button"
              class="action-icon-btn delete-btn"
              (click)="removeQuestion(questionIndex)"
              title="ุญุฐู"
            >
              ๐๏ธ
            </button>
          </div>
        </div>

        <div class="question-body">
          <div class="form-row">
            <div class="form-group full-width">
              <label [for]="'label_' + questionIndex" class="form-label required">
                ูุต ุงูุณุคุงู
              </label>
              <input
                pInputText
                type="text"
                [id]="'label_' + questionIndex"
                [name]="'label_' + questionIndex"
                [(ngModel)]="question.label"
                required
                placeholder="ูุซุงู: ูุง ูู ุฎุจุฑุชู ูู ุงูุจุฑูุฌุฉุ"
                class="form-control"
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label [for]="'question_type_' + questionIndex" class="form-label required">
                ููุน ุงูุณุคุงู
              </label>
              <p-select
                [id]="'question_type_' + questionIndex"
                [name]="'question_type_' + questionIndex"
                [(ngModel)]="question.question_type"
                [options]="questionTypes"
                optionLabel="label"
                optionValue="value"
                placeholder="ุงุฎุชุฑ ููุน ุงูุณุคุงู"
                styleClass="w-full"
                (ngModelChange)="onQuestionTypeChange(questionIndex)"
              ></p-select>
            </div>

            <div class="form-group">
              <div class="checkbox-group">
                <p-checkbox
                  [(ngModel)]="question.required"
                  [binary]="true"
                  [inputId]="'required_' + questionIndex"
                  [name]="'required_' + questionIndex"
                ></p-checkbox>
                <label [for]="'required_' + questionIndex" class="checkbox-label">
                  ุฅุฌุจุงุฑู
                </label>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label [for]="'help_text_' + questionIndex" class="form-label">
              ูุต ูุณุงุนุฏ (ุงุฎุชูุงุฑู)
            </label>
            <input
              pInputText
              type="text"
              [id]="'help_text_' + questionIndex"
              [name]="'help_text_' + questionIndex"
              [(ngModel)]="question.help_text"
              placeholder="ูุต ุชูุถูุญู ูููุณุงุนุฏุฉ ูู ุงูุฅุฌุงุจุฉ"
              class="form-control"
            />
          </div>

          @if (needsOptions(question.question_type)) {
          <div class="form-group">
            <div class="options-header">
              <label class="form-label required">ุงูุฎูุงุฑุงุช</label>
              <button
                type="button"
                class="btn btn-primary btn-sm"
                (click)="addOption(questionIndex)"
              >
                <span>+</span> ุฅุถุงูุฉ ุฎูุงุฑ
              </button>
            </div>
            
            @if (!question.optionsArray || question.optionsArray.length === 0) {
            <div class="empty-options">
              <p>ูุง ุชูุฌุฏ ุฎูุงุฑุงุช. ุงููุฑ ุนูู "ุฅุถุงูุฉ ุฎูุงุฑ" ูุฅุถุงูุฉ ุฎูุงุฑุงุช.</p>
            </div>
            }
            
            @if (question.optionsArray && question.optionsArray.length > 0) {
            <div class="options-list">
              @for (option of question.optionsArray; track $index) {
              <div class="option-item">
                <label [for]="'option_' + questionIndex + '_' + $index" class="sr-only">
                  {{ 'ุฎูุงุฑ ' + ($index + 1) }}
                </label>
                <input
                  pInputText
                  type="text"
                  [id]="'option_' + questionIndex + '_' + $index"
                  [name]="'option_' + questionIndex + '_' + $index"
                  [(ngModel)]="question.optionsArray[$index]"
                  [placeholder]="'ุฎูุงุฑ ' + ($index + 1)"
                  class="form-control option-input"
                />
                <button
                  type="button"
                  class="action-icon-btn delete-btn"
                  (click)="removeOption(questionIndex, $index)"
                  title="ุญุฐู ุงูุฎูุงุฑ"
                >
                  ๐๏ธ
                </button>
              </div>
              }
            </div>
            }
          </div>
          }
        </div>
      </div>
      }
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <p-button
        type="button"
        label="ุฅูุบุงุก"
        styleClass="p-button-secondary"
        (onClick)="cancel()"
        [disabled]="saving"
      ></p-button>
      <p-button
        type="submit"
        [label]="saving ? 'ุฌุงุฑู ุงูุญูุธ...' : (isEditMode ? 'ุชุญุฏูุซ' : 'ุฅูุดุงุก')"
        styleClass="p-button-primary"
        [disabled]="saving"
        [loading]="saving"
      ></p-button>
    </div>
  </form>
  }
</div>

