<div id="applicants" class="applicants-container">
  <!-- Header Skeleton -->
  @if (loading) {
  <div class="employer-header">
    <div class="skeleton-header-content">
      <p-skeleton width="250px" height="2rem" styleClass="mb-2"></p-skeleton>
      <p-skeleton width="200px" height="1.2rem"></p-skeleton>
    </div>
    <div class="skeleton-header-actions">
      <p-skeleton width="180px" height="2.5rem" styleClass="mb-0"></p-skeleton>
    </div>
  </div>
  }

  <!-- Actual Header -->
  @if (!loading) {
  <div class="employer-header">
    <div>
      <h1 class="employer-title">Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙˆÙ† Ù„Ù„ÙˆØ¸ÙŠÙØ©</h1>
      @if (jobTitle) {
        <p class="job-title">{{ jobTitle }}</p>
      }
    </div>
    <div class="employer-actions">
      <a [routerLink]="['/companies/manage-jobs']" class="btn btn-secondary">
        Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
      </a>
    </div>
  </div>
  }

  <div class="employer-content-card">
    <!-- Status Filter Tabs Skeleton -->
    @if (loading) {
    <div class="tab-navigation">
      @for (item of [1,2,3,4,5]; track item) {
      <p-skeleton width="140px" height="2.5rem" styleClass="mb-0"></p-skeleton>
      }
    </div>
    }

    <!-- Status Filter Tabs -->
    @if (!loading) {
    <div class="tab-navigation">
      <button 
        class="tab" 
        [class.active]="statusFilter === 'all'"
        (click)="setStatusFilter('all')">
        Ø§Ù„ÙƒÙ„ ({{ statusCounts.all }})
      </button>
      <button 
        class="tab" 
        [class.active]="statusFilter === 'pending'"
        (click)="setStatusFilter('pending')">
        Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ({{ statusCounts.pending }})
      </button>
      <button 
        class="tab" 
        [class.active]="statusFilter === 'reviewed'"
        (click)="setStatusFilter('reviewed')">
        ØªÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ({{ statusCounts.reviewed }})
      </button>
      <button 
        class="tab" 
        [class.active]="statusFilter === 'accepted'"
        (click)="setStatusFilter('accepted')">
        Ù…Ù‚Ø¨ÙˆÙ„ ({{ statusCounts.accepted }})
      </button>
      <button 
        class="tab" 
        [class.active]="statusFilter === 'rejected'"
        (click)="setStatusFilter('rejected')">
        Ù…Ø±ÙÙˆØ¶ ({{ statusCounts.rejected }})
      </button>
    </div>
    }

    <!-- Loading State Skeleton -->
    @if (loading) {
      <div class="tab-content">
        @for (item of [1,2,3]; track item) {
        <div class="application-item">
          <div class="application-info">
            <div class="candidate-header">
              <p-skeleton width="60px" height="60px" shape="circle" styleClass="skeleton-avatar"></p-skeleton>
              <div class="candidate-details">
                <p-skeleton width="200px" height="1.5rem" styleClass="mb-2"></p-skeleton>
                <p-skeleton width="60%" height="1rem" styleClass="mb-2"></p-skeleton>
                <div class="candidate-meta">
                  <p-skeleton width="150px" height="1rem" styleClass="mb-0"></p-skeleton>
                  <p-skeleton width="120px" height="1rem" styleClass="mb-0"></p-skeleton>
                  <p-skeleton width="100px" height="1rem" styleClass="mb-0"></p-skeleton>
                </div>
                <p-skeleton width="100%" height="3rem" styleClass="mb-0 mt-2"></p-skeleton>
              </div>
            </div>
          </div>
          <div class="application-actions">
            <p-skeleton width="100px" height="1.5rem" styleClass="mb-2"></p-skeleton>
            <div class="action-buttons">
              <p-skeleton width="100%" height="2.5rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="100%" height="2.5rem" styleClass="mb-0"></p-skeleton>
            </div>
            <div class="status-actions">
              <p-skeleton width="80px" height="2.5rem" styleClass="mb-0"></p-skeleton>
              <p-skeleton width="80px" height="2.5rem" styleClass="mb-0"></p-skeleton>
            </div>
          </div>
        </div>
        }
      </div>
    }

    <!-- Empty State -->
    @if (!loading && filteredApplications.length === 0) {
      <div class="tab-content">
        <div class="empty">
          <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>
        </div>
      </div>
    }


    <!-- Applications List -->
    @if (!loading && filteredApplications.length > 0) {
      <div class="tab-content">
        @for (app of filteredApplications; track app.id) {
          <div class="application-item">
              <div class="application-info">
                <div class="candidate-header">
                  <div class="candidate-avatar">
                    @if (app.applicant?.profile_picture) {
                      <img 
                        [src]="app.applicant?.profile_picture || ''" 
                        [alt]="getApplicantName(app)"
                        [title]="getApplicantName(app)"
                        title="Applicant profile picture"
                        (error)="handleImageError($event)">
                    }
                    <span [style.display]="app.applicant?.profile_picture ? 'none' : 'flex'">
                      {{ getApplicantInitials(app) }}
                    </span>
                  </div>
                  <div class="candidate-details">
                    <h4 class="candidate-name">
                      {{ getApplicantName(app) }}
                    </h4>
                    @if (app.applicant?.bio) {
                      <p class="candidate-title">
                        {{ app.applicant?.bio }}
                      </p>
                    }
                    <div class="candidate-meta">
                      <span>ğŸ“§ {{ app.applicant?.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</span>
                      @if (app.applicant?.phone) {
                        <span>ğŸ“ {{ getApplicantPhone(app) }}</span>
                      }
                      <span>ğŸ“… {{ formatDate(app.applied_at) }}</span>
                    </div>
                    @if (app.cover_letter) {
                      <div class="cover-letter-preview">
                        <p class="cover-letter-text">{{ app.cover_letter }}</p>
                      </div>
                    }
                  </div>
                </div>
              </div>

              <div class="application-actions">
                <span 
                  class="application-status" 
                  [ngClass]="getStatusClass(app.status)">
                  {{ getStatusLabel(app) }}
                </span>
                <div class="action-buttons">
                  <button 
                    class="btn btn-small btn-primary"
                    (click)="viewApplication(app)">
                    Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                  </button>
                  @if (app.resume) {
                    <button 
                      class="btn btn-small btn-secondary"
                      (click)="downloadResume(app)">
                      ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©
                    </button>
                  }
                </div>
                @if (app.status === 'pending') {
                  <div class="status-actions">
                    <button 
                      class="btn btn-small btn-success"
                      (click)="updateApplicationStatus(app.id, 'accepted')">
                      Ù‚Ø¨ÙˆÙ„
                    </button>
                    <button 
                      class="btn btn-small btn-danger"
                      (click)="updateApplicationStatus(app.id, 'rejected')">
                      Ø±ÙØ¶
                    </button>
                  </div>
                }
              </div>
            </div>
        }
      </div>
    }
  </div>
</div>

<!-- Application Details Modal -->
@if (showDetailsModal) {
  <div class="modal-backdrop" (click)="closeDetailsModal()">
    <div class="modal-dialog" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
        <button class="modal-close" (click)="closeDetailsModal()">Ã—</button>
      </div>

      <div class="modal-body">
        @if (loadingDetails) {
          <div class="loading-state">
            <div class="skeleton-details">
              <p-skeleton width="100%" height="1.5rem" styleClass="mb-3"></p-skeleton>
              <p-skeleton width="100%" height="1rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="80%" height="1rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="90%" height="1rem" styleClass="mb-4"></p-skeleton>
              <p-skeleton width="100%" height="1.5rem" styleClass="mb-3"></p-skeleton>
              <p-skeleton width="100%" height="1rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="75%" height="1rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="85%" height="1rem" styleClass="mb-4"></p-skeleton>
            </div>
          </div>
        } @else if (selectedApplication) {
          <!-- Job Information -->
          <div class="detail-section">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙØ©</h3>
            <div class="detail-content">
              <div class="detail-item">
                <span class="detail-label">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ¸ÙŠÙØ©:</span>
                <span class="detail-value">{{ selectedApplication.job.title }}</span>
              </div>
              @if (selectedApplication.job.category) {
                <div class="detail-item">
                  <span class="detail-label">Ø§Ù„ÙØ¦Ø©:</span>
                  <span class="detail-value">{{ selectedApplication.job.category.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</span>
                </div>
              }
              <div class="detail-item">
                <span class="detail-label">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©:</span>
                <span class="detail-value">{{ getJobTypeLabel(selectedApplication.job.job_type || '') }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±Ø©:</span>
                <span class="detail-value">{{ getExperienceLevelLabel(selectedApplication.job.experience_level || '') }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</span>
                <span class="detail-value">{{ selectedApplication.job.city || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ø±Ø§ØªØ¨:</span>
                <span class="detail-value">
                  {{ formatSalaryRange(
                    selectedApplication.job.salary_min || null,
                    selectedApplication.job.salary_max || null,
                    selectedApplication.job.is_salary_negotiable || false
                  ) }}
                </span>
              </div>
              @if (selectedApplication.job.application_deadline) {
                <div class="detail-item">
                  <span class="detail-label">Ø¢Ø®Ø± Ù…ÙˆØ¹Ø¯ Ù„Ù„ØªÙ‚Ø¯ÙŠÙ…:</span>
                  <span class="detail-value">{{ formatDate(selectedApplication.job.application_deadline) }}</span>
                </div>
              }
              @if (selectedApplication.job.company) {
                <div class="detail-item">
                  <span class="detail-label">Ø§Ù„Ø´Ø±ÙƒØ©:</span>
                  <span class="detail-value">{{ selectedApplication.job.company.name }}</span>
                </div>
              }
            </div>
            @if (selectedApplication.job.description) {
              <div class="job-description">
                <h4>ÙˆØµÙ Ø§Ù„ÙˆØ¸ÙŠÙØ©</h4>
                <p>{{ selectedApplication.job.description }}</p>
              </div>
            }
            @if (selectedApplication.job.requirements) {
              <div class="job-requirements">
                <h4>Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª</h4>
                <div class="requirements-content">{{ selectedApplication.job.requirements }}</div>
              </div>
            }
          </div>

          <!-- Applicant Information -->
          <div class="detail-section">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h3>
            <div class="detail-content">
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</span>
                <span class="detail-value">{{ getApplicantName(selectedApplication) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</span>
                <span class="detail-value">{{ selectedApplication.applicant?.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</span>
                <span class="detail-value">{{ selectedApplication.applicant?.username || 'ØºÙŠØ± Ù…ØªÙˆÙØ±' }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
                <span class="detail-value">{{ getApplicantPhone(selectedApplication) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
                <span class="detail-value">{{ getApplicantLocation(selectedApplication) }}</span>
              </div>
              @if (selectedApplication.applicant?.date_of_birth) {
                <div class="detail-item">
                  <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</span>
                  <span class="detail-value">{{ formatDate(selectedApplication.applicant?.date_of_birth || null) }}</span>
                </div>
              }
              @if (selectedApplication.applicant?.created_at) {
                <div class="detail-item">
                  <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨:</span>
                  <span class="detail-value">{{ formatDate(selectedApplication.applicant?.created_at || null) }}</span>
                </div>
              }
              <div class="detail-item">
                <span class="detail-label">Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚:</span>
                <span class="detail-value">
                  @if (selectedApplication.applicant?.is_verified) {
                    <span class="verified-badge">âœ“ Ù…ÙˆØ«Ù‚</span>
                  } @else {
                    <span class="unverified-badge">ØºÙŠØ± Ù…ÙˆØ«Ù‚</span>
                  }
                </span>
              </div>
              @if (selectedApplication.applicant?.bio) {
                <div class="detail-item full-width">
                  <span class="detail-label">Ù†Ø¨Ø°Ø© Ø´Ø®ØµÙŠØ©:</span>
                  <span class="detail-value">{{ selectedApplication.applicant?.bio || '' }}</span>
                </div>
              }
            </div>
          </div>

          <!-- Application Details -->
          <div class="detail-section">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
            <div class="detail-content">
              <div class="detail-item">
                <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</span>
                <span class="detail-value">{{ formatDateTime(selectedApplication.applied_at) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                <span class="detail-value">{{ formatDateTime(selectedApplication.updated_at) }}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
                <span class="detail-value status-badge" [ngClass]="getStatusClass(selectedApplication.status)">
                  {{ getStatusLabel(selectedApplication) }}
                </span>
              </div>
              <div class="detail-item">
                <span class="detail-label">ØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©:</span>
                <span class="detail-value">
                  @if (selectedApplication.is_viewed) {
                    <span class="viewed-badge">âœ“ ØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                    @if (selectedApplication.viewed_at) {
                      <span class="viewed-date">({{ formatDateTime(selectedApplication.viewed_at) }})</span>
                    }
                  } @else {
                    <span class="not-viewed-badge">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
                  }
                </span>
              </div>
              @if (selectedApplication.expected_salary) {
                <div class="detail-item">
                  <span class="detail-label">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span>
                  <span class="detail-value">{{ selectedApplication.expected_salary | number }} Ø±ÙŠØ§Ù„</span>
                </div>
              }
              @if (selectedApplication.availability_date) {
                <div class="detail-item">
                  <span class="detail-label">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙØ±:</span>
                  <span class="detail-value">{{ formatDate(selectedApplication.availability_date) }}</span>
                </div>
              }
              @if (selectedApplication.portfolio_url) {
                <div class="detail-item">
                  <span class="detail-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø©:</span>
                  <a [href]="selectedApplication.portfolio_url" target="_blank" class="detail-link" rel="noopener noreferrer">
                    {{ selectedApplication.portfolio_url }}
                  </a>
                </div>
              }
              @if (selectedApplication.rating !== null && selectedApplication.rating !== undefined) {
                <div class="detail-item">
                  <span class="detail-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                  <span class="detail-value">
                    <span class="rating-stars">
                      @for (star of [1,2,3,4,5]; track star) {
                        <span [class.filled]="star <= (selectedApplication.rating || 0)">â˜…</span>
                      }
                    </span>
                    ({{ selectedApplication.rating }}/5)
                  </span>
                </div>
              }
            </div>
          </div>

          <!-- Cover Letter -->
          @if (selectedApplication.cover_letter) {
            <div class="detail-section">
              <h3>Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</h3>
              <div class="cover-letter-content">
                <p>{{ selectedApplication.cover_letter }}</p>
              </div>
            </div>
          }

          <!-- Resume -->
          @if (selectedApplication.resume) {
            <div class="detail-section">
              <h3>Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</h3>
              <button 
                class="btn btn-primary"
                (click)="downloadResume(selectedApplication)">
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©
              </button>
            </div>
          }

          <!-- Notes -->
          @if (selectedApplication.notes) {
            <div class="detail-section">
              <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h3>
              <div class="notes-content">
                <p>{{ selectedApplication.notes }}</p>
              </div>
            </div>
          }

          <!-- Employer Notes -->
          @if (selectedApplication.employer_notes) {
            <div class="detail-section">
              <h3>Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù…Ù„</h3>
              <div class="notes-content">
                <p>{{ selectedApplication.employer_notes }}</p>
              </div>
            </div>
          }

          <!-- Action Buttons -->
          @if (selectedApplication.status === 'pending') {
            <div class="modal-actions">
              <button 
                class="btn btn-success"
                (click)="updateApplicationStatus(selectedApplication.id, 'accepted'); closeDetailsModal();">
                Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨
              </button>
              <button 
                class="btn btn-danger"
                (click)="updateApplicationStatus(selectedApplication.id, 'rejected'); closeDetailsModal();">
                Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨
              </button>
            </div>
          }
        }
      </div>
    </div>
  </div>
}

