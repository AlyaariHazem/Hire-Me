<div class="user-edit-page">
  <div class="user-card">
    <!-- Header -->
    <div class="user-card-header">
      <div class="user-picture-wrapper">
        <div class="user-picture-circle">
          <img
            [src]="profilePicture$ || 'https://via.placeholder.com/88'"
            alt="صورة المستخدم"
          />
        </div>

        <button
          type="button"
          class="picture-change-btn"
          (click)="pictureInput.click()"
        >
          تغيير الصورة
        </button>

        <input
          #pictureInput
          type="file"
          class="picture-file-input"
          accept="image/*"
          (change)="onProfilePictureSelected($event)"
          title="اختر صورة الملف الشخصي"
          aria-label="اختر صورة الملف الشخصي"
        />
      </div>

      <div class="user-header-text">
        <h1 class="user-title">تحديث بيانات المستخدم</h1>
        <p class="user-subtitle">
          حدّث معلوماتك الشخصية ليظهر ملفك التعريفي بشكل احترافي.
        </p>
      </div>
    </div>

    <div class="user-divider"></div>

    <!-- Form -->
    <form class="user-form" (ngSubmit)="save()">
      <div class="form-grid">
        <!-- First Name -->
        <div class="form-group">
          <label class="form-label" for="first_name">الاسم الأول</label>
          <input
            pInputText
            id="first_name"
            required
            [(ngModel)]="form.first_name"
            name="first_name"
            placeholder="مثال: Hazem"
            #firstNameCtrl="ngModel"
            [class.p-invalid]="firstNameCtrl.invalid && (firstNameCtrl.dirty || firstNameCtrl.touched)"
          />
          <small
            class="p-error"
            *ngIf="firstNameCtrl.errors?.['required'] && (firstNameCtrl.dirty || firstNameCtrl.touched)"
          >
            الاسم الأول مطلوب
          </small>
        </div>

        <!-- Last Name -->
        <div class="form-group">
          <label class="form-label" for="last_name">الاسم الأخير</label>
          <input
            pInputText
            id="last_name"
            required
            [(ngModel)]="form.last_name"
            name="last_name"
            placeholder="مثال: AL-yaari"
            #lastNameCtrl="ngModel"
            [class.p-invalid]="lastNameCtrl.invalid && (lastNameCtrl.dirty || lastNameCtrl.touched)"
          />
          <small
            class="p-error"
            *ngIf="lastNameCtrl.errors?.['required'] && (lastNameCtrl.dirty || lastNameCtrl.touched)"
          >
            الاسم الأخير مطلوب
          </small>
        </div>

        <!-- Email -->
        <div class="form-group">
          <label class="form-label" for="email">البريد الإلكتروني</label>
          <input
            pInputText
            type="email"
            id="email"
            required
            [(ngModel)]="form.email"
            name="email"
            placeholder="مثال: user@example.com"
            #emailCtrl="ngModel"
            [class.p-invalid]="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)"
          />
          <small
            class="p-error"
            *ngIf="emailCtrl.errors?.['required'] && (emailCtrl.dirty || emailCtrl.touched)"
          >
            البريد الإلكتروني مطلوب
          </small>
          <small
            class="p-error"
            *ngIf="emailCtrl.errors?.['email'] && (emailCtrl.dirty || emailCtrl.touched)"
          >
            بريد إلكتروني غير صالح
          </small>
        </div>

        <!-- Phone -->
        <div class="form-group">
          <label class="form-label" for="phone">رقم الهاتف</label>
          <input
            pInputText
            type="tel"
            id="phone"
            [(ngModel)]="form.phone"
            name="phone"
            placeholder="مثال: 777777711"
          />
        </div>

        <!-- Date of Birth -->
        <div class="form-group">
          <label class="form-label" for="date_of_birth">تاريخ الميلاد</label>
          <input
            pInputText
            type="date"
            id="date_of_birth"
            [(ngModel)]="form.date_of_birth"
            name="date_of_birth"
          />
        </div>

        <!-- Location -->
        <div class="form-group">
          <label class="form-label" for="location">الموقع</label>
          <input
            pInputText
            id="location"
            [(ngModel)]="form.location"
            name="location"
            placeholder="مثال:  صنعاء, عدن"
          />
        </div>

        <!-- Bio -->
        <div class="form-group form-group-full">
          <label class="form-label" for="bio">نبذة مختصرة</label>
          <textarea
            pTextarea
            id="bio"
            rows="4"
            [(ngModel)]="form.bio"
            name="bio"
            placeholder="اكتب نبذة مختصرة عنك..."
          ></textarea>
        </div>

        <!-- Profile Picture note -->
        <div class="form-group form-group-full">
          <label class="form-label">صورة الملف الشخصي</label>
          <p class="help-text">
            يمكن تغيير الصورة من زر &quot;تغيير الصورة&quot; في الأعلى. يفضّل
            رفع صورة مربعة (PNG أو JPG).
          </p>
        </div>
      </div>

      <div class="form-actions">
        <p-button
          type="submit"
          [label]="saving ? 'جارٍ حفظ التغييرات...' : 'حفظ التغييرات'"
          [disabled]="saving"
          [loading]="saving"
          styleClass="p-button-primary"
        ></p-button>
      </div>
    </form>
  </div>
</div>

