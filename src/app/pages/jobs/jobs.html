<!-- Search Header Skeleton -->
@if (isLoading) {
<section class="search-page-header">
  <div class="container">
    <div class="search-form">
      <div class="search-fields">
        <p-skeleton width="100%" height="48px" styleClass="mb-0"></p-skeleton>
        <p-skeleton width="100%" height="48px" styleClass="mb-0"></p-skeleton>
        <p-skeleton width="100%" height="48px" styleClass="mb-0"></p-skeleton>
      </div>
      <p-skeleton width="100%" height="48px" styleClass="mb-0"></p-skeleton>
    </div>
  </div>
</section>
}

<!-- Search Header -->
@if (!isLoading) {
<section class="search-page-header">
      <div class="container">
        <form
          class="search-form"
          (ngSubmit)="onSearchSubmit()"
        >
          <div class="search-fields">
            <div class="field-group">
              <input
                pInputText
                type="text"
                id="job-title"
                placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø£Ùˆ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©"
                name="search"
                [(ngModel)]="searchValue"
              />
            </div>

            <div class="field-group">
              <p-select
                id="location"
                name="city"
                [(ngModel)]="filters.city"
                [options]="cityOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹"
                [showClear]="true"
                (onChange)="onCityChange($event.value || '')"
                appendTo="body"
                styleClass="w-full"
              ></p-select>
            </div>

            <div class="field-group">
              <p-select
                id="category"
                name="category"
                [(ngModel)]="filters.category"
                [options]="categoryOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø§Øª"
                [showClear]="true"
                (onChange)="onCategoryChange($event.value)"
                appendTo="body"
                styleClass="w-full"
              ></p-select>
            </div>
          </div>

          <p-button
            type="submit"
            [label]="isSearching ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...' : 'Ø¨Ø­Ø«'"
            icon="pi pi-search"
            styleClass="p-button-primary search-btn"
            [disabled]="isSearching || isLoading"
          ></p-button>
        </form>
      </div>
    </section>
}
    <section class="search-results-section">
      <div class="container">
        <div class="search-results-container">
          <!-- Filters Sidebar Skeleton -->
          @if (isLoading) {
          <aside class="filters-sidebar">
            <div class="filter-section">
              <p-skeleton width="120px" height="1.5rem" styleClass="mb-2"></p-skeleton>
              @for (item of [1,2,3,4]; track item) {
              <div class="filter-option skeleton-filter-option">
                <p-skeleton width="20px" height="20px" shape="rectangle" styleClass="skeleton-checkbox"></p-skeleton>
                <p-skeleton width="100px" height="1rem" styleClass="skeleton-filter-text"></p-skeleton>
                <p-skeleton width="30px" height="1rem" styleClass="skeleton-filter-count"></p-skeleton>
              </div>
              }
            </div>
            <div class="filter-section">
              <p-skeleton width="120px" height="1.5rem" styleClass="mb-2"></p-skeleton>
              @for (item of [1,2,3]; track item) {
              <div class="filter-option skeleton-filter-option">
                <p-skeleton width="20px" height="20px" shape="rectangle" styleClass="skeleton-checkbox"></p-skeleton>
                <p-skeleton width="120px" height="1rem" styleClass="skeleton-filter-text"></p-skeleton>
                <p-skeleton width="30px" height="1rem" styleClass="skeleton-filter-count"></p-skeleton>
              </div>
              }
            </div>
            <div class="filter-actions">
              <p-skeleton width="100%" height="2.5rem" styleClass="mb-2"></p-skeleton>
              <p-skeleton width="100%" height="2.5rem" styleClass="mb-0"></p-skeleton>
            </div>
          </aside>
          }

          <!-- Filters Sidebar -->
          @if (!isLoading) {
          <aside class="filters-sidebar">
            <div class="filter-section">
              <h3 class="filter-title">Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¸ÙŠÙØ©</h3>
              <div class="filter-options">
                <div
                  class="filter-option"
                  (click)="setJobType('full_time')"
                  [class.active]="filters.job_type === 'full_time'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ø¯ÙˆØ§Ù… ÙƒØ§Ù…Ù„</span>
                  <span class="filter-count"
                    >({{ filterCounts.jobType.full_time }})</span
                  >
                </div>

                <div
                  class="filter-option"
                  (click)="setJobType('part_time')"
                  [class.active]="filters.job_type === 'part_time'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ø¯ÙˆØ§Ù… Ø¬Ø²Ø¦ÙŠ</span>
                  <span class="filter-count"
                    >({{ filterCounts.jobType.part_time }})</span
                  >
                </div>

                <div
                  class="filter-option"
                  (click)="setJobType('contract')"
                  [class.active]="filters.job_type === 'contract'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ø¹Ù‚Ø¯ Ù…Ø¤Ù‚Øª</span>
                  <span class="filter-count"
                    >({{ filterCounts.jobType.contract }})</span
                  >
                </div>

                <div
                  class="filter-option"
                  (click)="setJobType('freelance')"
                  [class.active]="filters.job_type === 'freelance'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ø¹Ù…Ù„ Ø¹Ù† Ø¨ÙØ¹Ø¯</span>
                  <span class="filter-count"
                    >({{ filterCounts.jobType.freelance }})</span
                  >
                </div>
              </div>
            </div>

            <!-- Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±Ø© -->
            <div class="filter-section">
              <h3 class="filter-title">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±Ø©</h3>
              <div class="filter-options">
                <div
                  class="filter-option"
                  (click)="setExperienceLevel('entry')"
                  [class.active]="filters.experience_level === 'entry'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ù…Ø¨ØªØ¯Ø¦ (0-2 Ø³Ù†Ø©)</span>
                  <span class="filter-count"
                    >({{ filterCounts.experienceLevel.entry }})</span
                  >
                </div>

                <div
                  class="filter-option"
                  (click)="setExperienceLevel('mid')"
                  [class.active]="filters.experience_level === 'mid'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ù…ØªÙˆØ³Ø· (3-5 Ø³Ù†ÙˆØ§Øª)</span>
                  <span class="filter-count"
                    >({{ filterCounts.experienceLevel.mid }})</span
                  >
                </div>

                <div
                  class="filter-option"
                  (click)="setExperienceLevel('senior')"
                  [class.active]="filters.experience_level === 'senior'"
                >
                  <div class="filter-checkbox"></div>
                  <span>Ø®Ø¨ÙŠØ± (6+ Ø³Ù†ÙˆØ§Øª)</span>
                  <span class="filter-count"
                    >({{ filterCounts.experienceLevel.senior }})</span
                  >
                </div>
              </div>
            </div>

            <!-- <div class="filter-actions">
              <button
                class="btn btn-small btn-primary filter-apply-btn"
                (click)="applyFilters()"
                [disabled]="isApplyingFilters || isLoading"
              >
                @if (isApplyingFilters) {
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...
                } @else {
                  ØªØ·Ø¨ÙŠÙ‚
                }
              </button>
              <button
                class="btn btn-small btn-secondary filter-clear-btn"
                (click)="clearAllFilters()"
                [disabled]="isClearingFilters || isLoading"
              >
                @if (isClearingFilters) {
                  Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø³Ø­...
                } @else {
                  Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„
                }
              </button>
            </div> -->
          </aside>
          }

          <!-- Results Content Skeleton -->
          @if (isLoading) {
          <main class="results-content">
            <div class="results-header">
              <p-skeleton width="200px" height="1.5rem" styleClass="mb-0"></p-skeleton>
              <div class="sort-dropdown">
                <p-skeleton width="150px" height="2.5rem" styleClass="mb-0"></p-skeleton>
              </div>
            </div>

            <div class="job-results">
              @for (item of [1,2,3,4,5,6]; track item) {
              <article class="job-card-horizontal">
                <p-skeleton width="80px" height="80px" shape="rectangle" styleClass="skeleton-company-logo"></p-skeleton>
                <div class="job-info">
                  <p-skeleton width="60%" height="1.5rem" styleClass="mb-2"></p-skeleton>
                  <p-skeleton width="40%" height="1rem" styleClass="mb-2"></p-skeleton>
                  <div class="job-meta">
                    <p-skeleton width="100px" height="1rem" styleClass="mb-0"></p-skeleton>
                    <p-skeleton width="120px" height="1rem" styleClass="mb-0"></p-skeleton>
                    <p-skeleton width="100px" height="1rem" styleClass="mb-0"></p-skeleton>
                    <p-skeleton width="80px" height="1rem" styleClass="mb-0"></p-skeleton>
                  </div>
                  <p-skeleton width="100%" height="1rem" styleClass="mb-1"></p-skeleton>
                  <p-skeleton width="90%" height="1rem" styleClass="mb-2"></p-skeleton>
                  <div class="job-tags">
                    <p-skeleton width="80px" height="1.5rem" styleClass="mb-0"></p-skeleton>
                    <p-skeleton width="60px" height="1.5rem" styleClass="mb-0"></p-skeleton>
                    <p-skeleton width="100px" height="1.5rem" styleClass="mb-0"></p-skeleton>
                  </div>
                </div>
                <div class="job-actions">
                  <p-skeleton width="100px" height="2.5rem" styleClass="mb-2"></p-skeleton>
                  <p-skeleton width="80px" height="2.5rem" styleClass="mb-2"></p-skeleton>
                  <p-skeleton width="80px" height="2.5rem" styleClass="mb-0"></p-skeleton>
                </div>
              </article>
              }
            </div>
          </main>
          }

          <!-- Results Content -->
          @if (!isLoading) {
          <main class="results-content">
            <div class="results-header">
              <div class="results-count">
                <strong>{{ totalJobs }} ÙˆØ¸ÙŠÙØ©</strong>
                ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ
              </div>

              <div class="sort-dropdown">
                <label for="sort">ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨:</label>
                <p-select
                  id="sort"
                  name="sort"
                  [(ngModel)]="sortValue"
                  [options]="sortOptions"
                  optionLabel="label"
                  optionValue="value"
                  (onChange)="onSortChange($event.value)"
                  appendTo="body"
                  styleClass="w-auto"
                ></p-select>
              </div>
            </div>

            <div class="job-results">
              @for(job of jobs; track job){
                <article
                  class="job-card-horizontal"
                  [attr.data-job-id]="job.id"
                >
                  <img
                    [src]="job.company.logo || 'assets/images/company-placeholder.png'"
                    [alt]="job.company.name || 'Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©'"
                    [title]="job.company.name || 'Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©'"
                    title="Company logo"
                    class="company-logo"
                  />
  
                  <div class="job-info">
                    <h3 class="job-title">
                      <a
                        (click)="navigate(job.slug)"
                        class="job-title-link"
                      >
                        {{ job.title }}
                      </a>
                    </h3>
  
                    <p class="company-name">{{ job.company.name || '-' }}</p>
  
                    <!-- meta row like your screenshot -->
                    <div class="job-meta">
                      <span>ğŸ“ {{ cityLabel(job.city) }}</span>
                      <span>ğŸ”¥ {{ formatSalary(job) }}</span>
                      <span>â° {{ jobTypeLabel(job.job_type) }}</span>
                      <span>ğŸ“… {{ timeAgo(job.created_at) }}</span>
                    </div>
  
                    <!-- description (if API sends it) -->
                     @if(job.description){
                       <p
                         class="job-description"
                       >
                         {{ job.description }}
                       </p>
                     }
  
                    <!-- fallback short line if no description -->
                     @if(!job.description){
                       <p
                         class="job-description"
                       >
                         {{ job.category.name || '-' }} â€¢ {{ job.company.city || '-' }}
                       </p>
                     }
  
                    <!-- tags row -->
                    <div class="job-tags">
                      <span class="job-tag">{{ jobTypeLabel(job.job_type) }}</span>
                      <span class="job-tag">{{ job.experience_level }}</span>
                      <span class="job-tag">{{ job.category.name || '-' }}</span>
                      <span class="job-tag">{{ cityLabel(job.city) }}</span>
                    </div>
                  </div>
  
                  <div class="job-actions">
                    <button
                      class="btn btn-small btn-secondary save-btn"
                      [class.active]="job.is_applied"
                      [class.loading]="applyingJobs.has(job.id)"
                      [disabled]="job.is_applied || applyingJobs.has(job.id)"
                      (click)="applyToJob(job)"
                    >
                      @if (applyingJobs.has(job.id)) {
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…...
                      } @else if (job.is_applied) {
                        ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…
                      } @else {
                        ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¢Ù†
                      }
                    </button>
  
                    <button
                      class="btn btn-small btn-secondary save-btn"
                      [ngClass]="job.is_bookmarked ? 'active' : ''"
                      [disabled]="savingJobs.has(job.id)"
                      (click)="saveJob(job)"
                    >
                      @if (savingJobs.has(job.id)) {
                        Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...
                      } @else if (job.is_bookmarked) {
                        Ù…Ø­ÙÙˆØ¸
                      } @else {
                        Ø­ÙØ¸
                      }
                    </button>
  
                    <button
                      class="btn btn-small btn-secondary"
                      (click)="shareJob(job)"
                    >
                      Ù…Ø´Ø§Ø±ÙƒØ©
                    </button>
                  </div>
                </article>
              }


              <!-- ÙÙŠ Ø­Ø§Ù„Ø© Ù…Ø§ ÙÙŠ ÙˆØ¸Ø§Ø¦Ù -->
               @if(jobs.length === 0){
                 <div class="no-jobs-message">
                   Ù„Ø§ ØªÙˆØ¬Ø¯ ÙˆØ¸Ø§Ø¦Ù Ù…Ø·Ø§Ø¨Ù‚Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.
                 </div>
               }
            </div>

            <!-- Pagination -->
            @if (totalPages > 1) {
            <div class="pagination-container">
              <p-paginator
                [rows]="page_size"
                [totalRecords]="totalJobs"
                appendTo="body"
                [first]="(currentPage - 1) * page_size"
                (onPageChange)="onPageChange($event)"
                [rowsPerPageOptions]="[5, 10, 20, 50]"
              ></p-paginator>
            </div>
            }

            <!-- Load More Button (Alternative to pagination) -->
            <div class="load-more-container hidden">
              <button class="btn btn-secondary load-more-btn">
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
              </button>
            </div>
          </main>
          }
        </div>
      </div>
    </section>
