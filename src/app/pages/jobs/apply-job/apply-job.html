<div class="apply-job-container">
  <div class="apply-job-header">
    <h2 class="apply-job-title">Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ù„ÙˆØ¸ÙŠÙØ©</h2>
    @if (jobTitle) {
    <p class="apply-job-subtitle">Ø§Ù„ÙˆØ¸ÙŠÙØ©: {{ jobTitle }}</p>
    }
  </div>

  <!-- External Link Application -->
  @if (applicationMethod === 'external_link') {
    <div class="application-method-card">
      <p class="method-description">Ø³ÙŠØªÙ… ØªÙˆØ¬ÙŠÙ‡Ùƒ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ Ù„Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</p>
      <p-button
        type="button"
        label="Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ"
        styleClass="p-button-primary"
        (onClick)="onSubmit()"
      ></p-button>
    </div>
  }

  <!-- Email Application -->
  @else if (applicationMethod === 'email') {
    <div class="application-method-card">
      <p class="method-description">Ø³ÙŠØªÙ… ÙØªØ­ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</p>
      <p-button
        type="button"
        label="Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"
        styleClass="p-button-primary"
        (onClick)="onSubmit()"
      ></p-button>
      @if (job && job.application_email) {
        <p class="email-address">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: {{ job.application_email }}</p>
      }
    </div>
  }

  <!-- Template File Application -->
  @else if (applicationMethod === 'template_file') {
    <div class="application-method-card">
      @if (job && job.application_template) {
        <p class="method-description">ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ ÙˆØªØ¹Ø¨Ø¦ØªÙ‡ Ø«Ù… Ø±ÙØ¹Ù‡</p>
        <div class="template-actions">
          <a
            [href]="job!.application_template!"
            target="_blank"
            class="btn-download-template"
          >
            ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨
          </a>
        </div>
      }
    </div>
    <form (ngSubmit)="onSubmit()" #applicationFormRef="ngForm" class="apply-job-form">
      <!-- Filled Template Upload -->
      <div class="form-group">
        <label for="filled_template" class="form-label required">
          Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø¨Ø£
        </label>
        @if (!filledTemplateFile) {
        <div class="file-upload-area" (click)="filledTemplateFileInput.click()">
          <div class="file-upload-content">
            <span class="file-upload-icon">ğŸ“</span>
            <p class="file-upload-text">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø¨Ø£</p>
            <p class="file-upload-hint">PDF, DOC, DOCX (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB)</p>
          </div>
          <input
            #filledTemplateFileInput
            type="file"
            id="filled_template"
            accept=".pdf,.doc,.docx"
            style="display: none"
            (change)="onFilledTemplateSelected($event)"
          />
        </div>
        } @else {
        <div class="file-selected">
          <div class="file-info">
            <span class="file-icon">ğŸ“</span>
            <span class="file-name">{{ filledTemplateFileName }}</span>
          </div>
          <button
            type="button"
            class="btn-remove-file"
            (click)="removeFilledTemplate()"
            title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù"
          >
            âœ•
          </button>
        </div>
        }
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <p-button
          type="button"
          label="Ø¥Ù„ØºØ§Ø¡"
          styleClass="p-button-secondary"
          (onClick)="onCancel()"
          [disabled]="isSubmitting"
        ></p-button>
        <p-button
          type="submit"
          [label]="isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨'"
          styleClass="p-button-primary"
          [disabled]="isSubmitting"
          [loading]="isSubmitting"
        ></p-button>
      </div>
    </form>
  }

  <!-- Custom Form Application -->
  @else if (applicationMethod === 'custom_form') {
    <form (ngSubmit)="onSubmit()" #applicationFormRef="ngForm" class="apply-job-form">
      @if (customFormQuestions.length > 0) {
        <div class="form-group">
          <h3 class="section-subtitle">Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</h3>
          @for (question of customFormQuestions; track question.id) {
            <div class="question-response">
              <label class="question-label">
                {{ question.label }}
                @if (question.required) {
                  <span class="required-badge">*</span>
                }
              </label>
              @if (question.help_text) {
                <p class="question-help">{{ question.help_text }}</p>
              }

              <!-- Text Input -->
              @if (question.question_type === 'text') {
                <input
                  pInputText
                  type="text"
                  [name]="'question_' + question.id"
                  [value]="getCustomFormResponse(question.id, question.question_type)"
                  (input)="updateCustomFormResponse(question.id, $any($event.target).value, question.question_type)"
                  [required]="question.required"
                  class="form-control"
                />
              }

              <!-- Textarea -->
              @else if (question.question_type === 'textarea') {
                <textarea
                  pTextarea
                  [name]="'question_' + question.id"
                  [value]="getCustomFormResponse(question.id, question.question_type)"
                  (input)="updateCustomFormResponse(question.id, $any($event.target).value, question.question_type)"
                  [required]="question.required"
                  rows="4"
                  class="form-control"
                ></textarea>
              }

              <!-- Select -->
              @else if (question.question_type === 'select') {
                <p-select
                  [options]="getSelectOptions(question.options)"
                  [name]="'question_' + question.id"
                  [ngModel]="getCustomFormResponse(question.id, question.question_type)"
                  (onChange)="updateCustomFormResponse(question.id, $event.value, question.question_type)"
                  [required]="question.required"
                  optionLabel="label"
                  optionValue="value"
                  placeholder="Ø§Ø®ØªØ±..."
                  styleClass="w-full"
                ></p-select>
              }

              <!-- Checkbox -->
              @else if (question.question_type === 'checkbox') {
                @if (question.options) {
                  @for (option of question.options.split(','); track option) {
                    <label class="checkbox-option">
                      <input
                        type="checkbox"
                        [value]="option.trim()"
                        [checked]="getCustomFormResponse(question.id, question.question_type).includes(option.trim())"
                        (change)="updateCustomFormResponse(question.id, option.trim(), question.question_type)"
                      />
                      {{ option.trim() }}
                    </label>
                  }
                } @else {
                  <label class="checkbox-option">
                    <input
                      type="checkbox"
                      [checked]="!!getCustomFormResponse(question.id, question.question_type)"
                      (change)="updateCustomFormResponse(question.id, $any($event.target).checked, question.question_type)"
                    />
                    Ù†Ø¹Ù…
                  </label>
                }
              }

              <!-- Number -->
              @else if (question.question_type === 'number') {
                @if (customFormResponses.get(question.id); as response) {
                  <p-inputNumber
                    [name]="'question_' + question.id"
                    [(ngModel)]="response.answer_text"
                    (onInput)="updateCustomFormResponse(question.id, $event.value, question.question_type)"
                    [required]="question.required"
                    styleClass="w-full"
                    [inputStyleClass]="'form-control'"
                  ></p-inputNumber>
                } @else {
                  <p-inputNumber
                    [name]="'question_' + question.id"
                    (onInput)="updateCustomFormResponse(question.id, $event.value, question.question_type)"
                    [required]="question.required"
                    styleClass="w-full"
                    [inputStyleClass]="'form-control'"
                  ></p-inputNumber>
                }
              }

              <!-- Date -->
              @else if (question.question_type === 'date') {
                @if (customFormResponses.get(question.id); as response) {
                  <p-datepicker
                    [name]="'question_' + question.id"
                    [(ngModel)]="response.answer_text"
                    (onSelect)="updateCustomFormResponse(question.id, $event, question.question_type)"
                    [required]="question.required"
                    [showIcon]="true"
                    dateFormat="yy-mm-dd"
                    placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®"
                    appendTo="body"
                  ></p-datepicker>
                } @else {
                  <p-datepicker
                    [name]="'question_' + question.id"
                    (onSelect)="updateCustomFormResponse(question.id, $event, question.question_type)"
                    [required]="question.required"
                    [showIcon]="true"
                    dateFormat="yy-mm-dd"
                    placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®"
                    appendTo="body"
                  ></p-datepicker>
                }
              }

              <!-- File -->
              @else if (question.question_type === 'file') {
                <input
                  type="file"
                  [name]="'question_' + question.id"
                  accept=".pdf,.doc,.docx"
                  (change)="onResponseFileSelected(question.id, $event)"
                  [required]="question.required"
                  class="form-control"
                />
                @if (responseFiles.has(question.id)) {
                  <span class="file-name-small">
                    {{ responseFiles.get(question.id)?.name }}
                    <button
                      type="button"
                      class="btn-remove-small"
                      (click)="removeResponseFile(question.id)"
                    >
                      âœ•
                    </button>
                  </span>
                }
              }
            </div>
          }
        </div>
      }

      <!-- Form Actions -->
      <div class="form-actions">
        <p-button
          type="button"
          label="Ø¥Ù„ØºØ§Ø¡"
          styleClass="p-button-secondary"
          (onClick)="onCancel()"
          [disabled]="isSubmitting"
        ></p-button>
        <p-button
          type="submit"
          [label]="isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨'"
          styleClass="p-button-primary"
          [disabled]="isSubmitting"
          [loading]="isSubmitting"
        ></p-button>
      </div>
    </form>
  }

  <!-- Platform (Default) Application -->
  @else {
    <form (ngSubmit)="onSubmit()" #applicationFormRef="ngForm" class="apply-job-form">
    <!-- Cover Letter -->
    <div class="form-group">
      <label for="cover_letter" class="form-label">
        Ø®Ø·Ø§Ø¨ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      <textarea
        pTextarea
        id="cover_letter"
        name="cover_letter"
        [(ngModel)]="applicationForm.cover_letter"
        rows="6"
        placeholder="Ø§ÙƒØªØ¨ Ø®Ø·Ø§Ø¨ ØªÙ‚Ø¯ÙŠÙ… ÙŠÙˆØ¶Ø­ Ø³Ø¨Ø¨ Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ Ø¨Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© ÙˆÙ…Ø¤Ù‡Ù„Ø§ØªÙƒ..."
        class="form-control"
      ></textarea>
    </div>

    <!-- Resume Upload -->
    <!-- <div class="form-group">
      <label for="resume" class="form-label">
        Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      @if (!resumeFile) {
      <div class="file-upload-area" (click)="resumeFileInput.click()">
        <div class="file-upload-content">
          <span class="file-upload-icon">ğŸ“„</span>
          <p class="file-upload-text">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©</p>
          <p class="file-upload-hint">PDF, DOC, DOCX (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB)</p>
        </div>
        <input
          #resumeFileInput
          type="file"
          id="resume"
          accept=".pdf,.doc,.docx"
          style="display: none"
          (change)="onResumeSelected($event)"
        />
      </div>
      } @else {
      <div class="file-selected">
        <div class="file-info">
          <span class="file-icon">ğŸ“„</span>
          <span class="file-name">{{ resumeFileName }}</span>
        </div>
        <button
          type="button"
          class="btn-remove-file"
          (click)="removeResume()"
          title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù"
        >
          âœ•
        </button>
      </div>
      }
    </div> -->

    <!-- Portfolio URL -->
    <div class="form-group">
      <label for="portfolio_url" class="form-label">
        Ø±Ø§Ø¨Ø· Ø§Ù„Ø£Ø¹Ù…Ø§Ù„
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      <input
        pInputText
        type="url"
        id="portfolio_url"
        name="portfolio_url"
        [(ngModel)]="applicationForm.portfolio_url"
        placeholder="https://example.com/portfolio"
        maxlength="200"
        class="form-control"
      />
      <small class="form-hint">Ø­Ø¯ Ø£Ù‚ØµÙ‰ 200 Ø­Ø±Ù</small>
    </div>

    <!-- Expected Salary -->
    <div class="form-group">
      <label for="expected_salary" class="form-label">
        Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      <p-inputNumber
        id="expected_salary"
        name="expected_salary"
        [(ngModel)]="applicationForm.expected_salary"
        [min]="0"
        [max]="2147483647"
        [showButtons]="true"
        [useGrouping]="true"
        placeholder="0"
        styleClass="w-full"
        [inputStyleClass]="'form-control'"
      ></p-inputNumber>
      <small class="form-hint">Ø¨Ø§Ù„Ø±ÙŠØ§Ù„ Ø§Ù„ÙŠÙ…Ù†ÙŠ</small>
    </div>

    <!-- Availability Date -->
    <div class="form-group">
      <label for="availability_date" class="form-label">
        ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙØ±
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      <p-datepicker
        id="availability_date"
        name="availability_date"
        [(ngModel)]="applicationForm.availability_date"
        [showIcon]="true"
        dateFormat="yy-mm-dd"
        placeholder="Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙØ±"
        appendTo="body"
      ></p-datepicker>
    </div>

    <!-- Notes -->
    <div class="form-group">
      <label for="notes" class="form-label">
        Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      <textarea
        pTextarea
        id="notes"
        name="notes"
        [(ngModel)]="applicationForm.notes"
        rows="4"
        placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ØªÙˆØ¯ Ø¥Ø¶Ø§ÙØªÙ‡Ø§..."
        class="form-control"
      ></textarea>
    </div>

    <!-- Filled Template -->
    <!-- <div class="form-group">
      <label for="filled_template" class="form-label">
        Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø¨Ø£
        <span class="optional-badge">(Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
      </label>
      @if (!filledTemplateFile) {
      <div class="file-upload-area" (click)="filledTemplateFileInput.click()">
        <div class="file-upload-content">
          <span class="file-upload-icon">ğŸ“</span>
          <p class="file-upload-text">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ø¨Ø£</p>
          <p class="file-upload-hint">PDF, DOC, DOCX (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB)</p>
        </div>
        <input
          #filledTemplateFileInput
          type="file"
          id="filled_template"
          accept=".pdf,.doc,.docx"
          style="display: none"
          (change)="onFilledTemplateSelected($event)"
        />
      </div>
      } @else {
      <div class="file-selected">
        <div class="file-info">
          <span class="file-icon">ğŸ“</span>
          <span class="file-name">{{ filledTemplateFileName }}</span>
        </div>
        <button
          type="button"
          class="btn-remove-file"
          (click)="removeFilledTemplate()"
          title="Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù"
        >
          âœ•
        </button>
      </div>
      }
    </div> -->

    <!-- Job Questions Responses (if any) -->
    @if (jobQuestions.length > 0) {
    <div class="form-group">
      <h3 class="section-subtitle">Ø£Ø³Ø¦Ù„Ø© Ø§Ù„ÙˆØ¸ÙŠÙØ©</h3>
      @for (question of jobQuestions; track question.id) {
      <div class="question-response">
        <label class="question-label">{{ question.text }}</label>
        <textarea
          pTextarea
          [ngModel]="getResponseText(question.id)"
          [name]="'response_' + question.id"
          rows="3"
          placeholder="Ø§ÙƒØªØ¨ Ø¥Ø¬Ø§Ø¨ØªÙƒ Ù‡Ù†Ø§..."
          class="form-control"
          (ngModelChange)="updateResponseText(question.id, $event)"
        ></textarea>
        <div class="response-file-upload">
          <label class="file-upload-label">
            <input
              type="file"
              [id]="'response_file_' + question.id"
              accept=".pdf,.doc,.docx"
              style="display: none"
              (change)="onResponseFileSelected(question.id, $event)"
            />
            <span class="file-upload-link">ğŸ“ Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</span>
          </label>
          @if (responseFiles.has(question.id)) {
          <span class="file-name-small">
            {{ responseFiles.get(question.id)?.name }}
            <button
              type="button"
              class="btn-remove-small"
              (click)="removeResponseFile(question.id)"
            >
              âœ•
            </button>
          </span>
          }
        </div>
      </div>
      }
    </div>
    }

    <!-- Form Actions -->
    <div class="form-actions">
      <p-button
        type="button"
        label="Ø¥Ù„ØºØ§Ø¡"
        styleClass="p-button-secondary"
        (onClick)="onCancel()"
        [disabled]="isSubmitting"
      ></p-button>
      <p-button
        type="submit"
        [label]="isSubmitting ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨'"
        styleClass="p-button-primary"
        [disabled]="isSubmitting"
        [loading]="isSubmitting"
      ></p-button>
    </div>
  </form>
  }
</div>

