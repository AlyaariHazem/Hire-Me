<div class="apply-job-container">
  <div class="apply-job-header">
    <h2 class="apply-job-title">ุงูุชูุฏูู ููุธููุฉ</h2>
    @if (jobTitle) {
    <p class="apply-job-subtitle">ุงููุธููุฉ: {{ jobTitle }}</p>
    }
  </div>

  <form (ngSubmit)="onSubmit()" #applicationFormRef="ngForm" class="apply-job-form">
    <!-- Cover Letter -->
    <div class="form-group">
      <label for="cover_letter" class="form-label">
        ุฎุทุงุจ ุงูุชูุฏูู
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      <textarea
        pTextarea
        id="cover_letter"
        name="cover_letter"
        [(ngModel)]="applicationForm.cover_letter"
        rows="6"
        placeholder="ุงูุชุจ ุฎุทุงุจ ุชูุฏูู ููุถุญ ุณุจุจ ุงูุชูุงูู ุจูุฐู ุงููุธููุฉ ููุคููุงุชู..."
        class="form-control"
      ></textarea>
    </div>

    <!-- Resume Upload -->
    <div class="form-group">
      <label for="resume" class="form-label">
        ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      @if (!resumeFile) {
      <div class="file-upload-area" (click)="resumeFileInput.click()">
        <div class="file-upload-content">
          <span class="file-upload-icon">๐</span>
          <p class="file-upload-text">ุงููุฑ ููุง ูุฑูุน ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ</p>
          <p class="file-upload-hint">PDF, DOC, DOCX (ุญุฏ ุฃูุตู 5MB)</p>
        </div>
        <input
          #resumeFileInput
          type="file"
          id="resume"
          accept=".pdf,.doc,.docx"
          style="display: none"
          (change)="onResumeSelected($event)"
        />
      </div>
      } @else {
      <div class="file-selected">
        <div class="file-info">
          <span class="file-icon">๐</span>
          <span class="file-name">{{ resumeFileName }}</span>
        </div>
        <button
          type="button"
          class="btn-remove-file"
          (click)="removeResume()"
          title="ุฅุฒุงูุฉ ุงูููู"
        >
          โ
        </button>
      </div>
      }
    </div>

    <!-- Portfolio URL -->
    <div class="form-group">
      <label for="portfolio_url" class="form-label">
        ุฑุงุจุท ุงูุฃุนูุงู
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      <input
        pInputText
        type="url"
        id="portfolio_url"
        name="portfolio_url"
        [(ngModel)]="applicationForm.portfolio_url"
        placeholder="https://example.com/portfolio"
        maxlength="200"
        class="form-control"
      />
      <small class="form-hint">ุญุฏ ุฃูุตู 200 ุญุฑู</small>
    </div>

    <!-- Expected Salary -->
    <div class="form-group">
      <label for="expected_salary" class="form-label">
        ุงูุฑุงุชุจ ุงููุชููุน
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      <p-inputNumber
        id="expected_salary"
        name="expected_salary"
        [(ngModel)]="applicationForm.expected_salary"
        [min]="0"
        [max]="2147483647"
        [showButtons]="true"
        [useGrouping]="true"
        placeholder="0"
        styleClass="w-full"
        [inputStyleClass]="'form-control'"
      ></p-inputNumber>
      <small class="form-hint">ุจุงูุฑูุงู ุงูุณุนูุฏู</small>
    </div>

    <!-- Availability Date -->
    <div class="form-group">
      <label for="availability_date" class="form-label">
        ุชุงุฑูุฎ ุงูุชููุฑ
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      <p-datepicker
        id="availability_date"
        name="availability_date"
        [(ngModel)]="applicationForm.availability_date"
        [showIcon]="true"
        dateFormat="yy-mm-dd"
        placeholder="ุงุฎุชุฑ ุชุงุฑูุฎ ุงูุชููุฑ"
        appendTo="body"
      ></p-datepicker>
    </div>

    <!-- Notes -->
    <div class="form-group">
      <label for="notes" class="form-label">
        ููุงุญุธุงุช
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      <textarea
        pTextarea
        id="notes"
        name="notes"
        [(ngModel)]="applicationForm.notes"
        rows="4"
        placeholder="ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ ุชูุฏ ุฅุถุงูุชูุง..."
        class="form-control"
      ></textarea>
    </div>

    <!-- Filled Template -->
    <div class="form-group">
      <label for="filled_template" class="form-label">
        ุงูููู ุงููุนุจุฃ
        <span class="optional-badge">(ุงุฎุชูุงุฑู)</span>
      </label>
      @if (!filledTemplateFile) {
      <div class="file-upload-area" (click)="filledTemplateFileInput.click()">
        <div class="file-upload-content">
          <span class="file-upload-icon">๐</span>
          <p class="file-upload-text">ุงููุฑ ููุง ูุฑูุน ุงูููู ุงููุนุจุฃ</p>
          <p class="file-upload-hint">PDF, DOC, DOCX (ุญุฏ ุฃูุตู 5MB)</p>
        </div>
        <input
          #filledTemplateFileInput
          type="file"
          id="filled_template"
          accept=".pdf,.doc,.docx"
          style="display: none"
          (change)="onFilledTemplateSelected($event)"
        />
      </div>
      } @else {
      <div class="file-selected">
        <div class="file-info">
          <span class="file-icon">๐</span>
          <span class="file-name">{{ filledTemplateFileName }}</span>
        </div>
        <button
          type="button"
          class="btn-remove-file"
          (click)="removeFilledTemplate()"
          title="ุฅุฒุงูุฉ ุงูููู"
        >
          โ
        </button>
      </div>
      }
    </div>

    <!-- Job Questions Responses (if any) -->
    @if (jobQuestions.length > 0) {
    <div class="form-group">
      <h3 class="section-subtitle">ุฃุณุฆูุฉ ุงููุธููุฉ</h3>
      @for (question of jobQuestions; track question.id) {
      <div class="question-response">
        <label class="question-label">{{ question.text }}</label>
        <textarea
          pTextarea
          [ngModel]="getResponseText(question.id)"
          [name]="'response_' + question.id"
          rows="3"
          placeholder="ุงูุชุจ ุฅุฌุงุจุชู ููุง..."
          class="form-control"
          (ngModelChange)="updateResponseText(question.id, $event)"
        ></textarea>
        <div class="response-file-upload">
          <label class="file-upload-label">
            <input
              type="file"
              [id]="'response_file_' + question.id"
              accept=".pdf,.doc,.docx"
              style="display: none"
              (change)="onResponseFileSelected(question.id, $event)"
            />
            <span class="file-upload-link">๐ ุฅุฑูุงู ููู (ุงุฎุชูุงุฑู)</span>
          </label>
          @if (responseFiles.has(question.id)) {
          <span class="file-name-small">
            {{ responseFiles.get(question.id)?.name }}
            <button
              type="button"
              class="btn-remove-small"
              (click)="removeResponseFile(question.id)"
            >
              โ
            </button>
          </span>
          }
        </div>
      </div>
      }
    </div>
    }

    <!-- Form Actions -->
    <div class="form-actions">
      <p-button
        type="button"
        label="ุฅูุบุงุก"
        styleClass="p-button-secondary"
        (onClick)="onCancel()"
        [disabled]="isSubmitting"
      ></p-button>
      <p-button
        type="submit"
        [label]="isSubmitting ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุฅุฑุณุงู ุงูุทูุจ'"
        styleClass="p-button-primary"
        [disabled]="isSubmitting"
        [loading]="isSubmitting"
      ></p-button>
    </div>
  </form>
</div>

