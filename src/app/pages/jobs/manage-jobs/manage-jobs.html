<div id="jobs" class="jobs-container">
  <div class="employer-header">
    <div>
      <h1 class="employer-title">إدارة الوظائف</h1>
      <p class="subtitle">عرض وإدارة جميع الوظائف المنشورة</p>
    </div>
    <div class="employer-actions">
      <a [routerLink]="['/companies/post-job']" class="btn btn-primary">نشر وظيفة جديدة</a>
    </div>
  </div>

  <div class="employer-content-card">
    <!-- Tab Navigation -->
    <div class="filters-section">
      <div class="tab-navigation">
        <button
          class="tab"
          [class.active]="activeTab() === 'active'"
          (click)="selectTab('active')"
        >
          الوظائف النشطة ({{ countActive() }})
        </button>
        <button
          class="tab"
          [class.active]="activeTab() === 'paused'"
          (click)="selectTab('paused')"
        >
          متوقفة ({{ countPaused() }})
        </button>
        <button
          class="tab"
          [class.active]="activeTab() === 'closed'"
          (click)="selectTab('closed')"
        >
          مغلقة ({{ countClosed() }})
        </button>
        <button
          class="tab"
          [class.active]="activeTab() === 'draft'"
          (click)="selectTab('draft')"
        >
          مسودات ({{ countDraft() }})
        </button>
      </div>
    </div>

    <!-- Loading State -->
    @if (loading) {
      <div class="tab-content">
        <div class="skeleton"></div>
      </div>
    }

    <!-- Empty State -->
    @if (!loading && visibleJobs().length === 0) {
      <div class="tab-content">
        <div class="empty">
          <p>لا توجد وظائف في هذه الفئة.</p>
          <a [routerLink]="['/companies/post-job']" class="btn btn-primary">نشر وظيفة جديدة</a>
        </div>
      </div>
    }

    <!-- Jobs List -->
    @if (!loading && visibleJobs().length > 0) {
      <div class="tab-content">
        @for (j of visibleJobs(); track j.id) {
          <div class="job-posting-item">
            <div class="job-posting-info">
              <h4 class="job-posting-title">
                <a
                  [routerLink]="['/companies/post-job']"
                  [queryParams]="{ edit: j.slug }"
                  class="job-title-link"
                >
                  {{ j.title }}
                </a>
              </h4>
              <div class="job-posting-meta">
                <span>نُشرت في {{ j.created_at | date:'yyyy/MM/dd' }}</span>
                <span>{{ j.city || '—' }}</span>
                <span>{{ salaryText(j) }}</span>
              </div>
              <div class="job-posting-stats">
                <span>{{ j.applications_count || 0 }} متقدم</span>
                <span>{{ j.views_count || 0 }} مشاهدة</span>
                @if (j.category) {
                  <span>{{ j.category.name }}</span>
                }
              </div>
            </div>
            <div class="job-posting-actions">
              <div class="status-control">
                <label for="status-{{ j.id }}" class="status-label">الحالة:</label>
                <select
                  id="status-{{ j.id }}"
                  class="status-select"
                  [value]="getJobStatus(j)"
                  [disabled]="isUpdating(j.id)"
                  (change)="updateJobStatus(j, $any($event.target).value)"
                  title="تغيير حالة الوظيفة"
                >
                  <option value="active">نشطة</option>
                  <option value="paused">متوقفة</option>
                  <option value="closed">مغلقة</option>
                </select>
                @if (isUpdating(j.id)) {
                  <span class="updating-indicator">جاري التحديث...</span>
                }
              </div>
              <div class="action-buttons">
                <a
                  [routerLink]="['/companies/applicants-for-job']"
                  [queryParams]="{ job: j.slug }"
                  class="btn btn-small btn-primary"
                >
                  عرض المتقدمين
                </a>
                <a
                  [routerLink]="['/companies/post-job']"
                  [queryParams]="{ edit: j.slug }"
                  class="btn btn-small btn-secondary"
                >
                  تحرير
                </a>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
