<div id="jobs" class="jobs-container">
  <!-- Header Skeleton -->
  @if (loading()) {
  <div class="employer-header">
    <div class="skeleton-header-content">
      <p-skeleton width="250px" height="2rem" styleClass="mb-2"></p-skeleton>
      <p-skeleton width="300px" height="1.2rem"></p-skeleton>
    </div>
    <div class="skeleton-header-actions">
      <p-skeleton width="150px" height="2.5rem" styleClass="mb-0"></p-skeleton>
    </div>
  </div>
  }

  <!-- Actual Header -->
  @if (!loading()) {
  <div class="employer-header">
    <div>
      <h1 class="employer-title">إدارة الوظائف</h1>
      <p class="subtitle">عرض وإدارة جميع الوظائف المنشورة</p>
    </div>
    <div class="employer-actions">
      <a [routerLink]="['/companies/post-job']" class="btn btn-primary btn-new-job">
        <span class="btn-icon">➕</span>
        <span>نشر وظيفة جديدة</span>
      </a>
    </div>
  </div>
  }

  <div class="employer-content-card">
    <!-- Tab Navigation Skeleton -->
    @if (loading()) {
    <div class="filters-section">
      <div class="tab-navigation">
        @for (item of [1,2,3,4]; track item) {
        <p-skeleton width="150px" height="2.5rem" styleClass="mb-0"></p-skeleton>
        }
      </div>
    </div>
    }

    <!-- Tab Navigation -->
    @if (!loading()) {
    <div class="filters-section">
      <div class="tab-navigation">
        <button class="tab" [class.active]="activeTab() === 'active'" (click)="selectTab('active')">
          <span class="tab-icon">✓</span>
          <span>الوظائف النشطة</span>
          <span class="tab-count">({{ countActive() }})</span>
        </button>
        <!-- <button class="tab" [class.active]="activeTab() === 'paused'" (click)="selectTab('paused')">
          <span class="tab-icon">⏸</span>
          <span>متوقفة</span>
          <span class="tab-count">({{ countPaused() }})</span>
        </button> -->
        <button class="tab" [class.active]="activeTab() === 'closed'" (click)="selectTab('closed')">
          <span class="tab-icon">✕</span>
          <span>مغلقة</span>
          <span class="tab-count">({{ countClosed() }})</span>
        </button>
        <!-- <button class="tab" [class.active]="activeTab() === 'draft'" (click)="selectTab('draft')">
          <span class="tab-icon"><i class="pi pi-file-edit"></i></span>
          <span>مسودات</span>
          <span class="tab-count">({{ countDraft() }})</span>
        </button> -->
      </div>
    </div>
    }

    <!-- Loading State Skeleton -->
    @if (loading()) {
    <div class="tab-content">
      @for (item of [1,2,3]; track item) {
      <div class="job-posting-item">
        <div class="job-posting-info">
          <p-skeleton width="60%" height="1.5rem" styleClass="mb-2"></p-skeleton>
          <div class="job-posting-meta">
            <p-skeleton width="150px" height="1rem" styleClass="mb-0"></p-skeleton>
            <p-skeleton width="80px" height="1rem" styleClass="mb-0"></p-skeleton>
            <p-skeleton width="120px" height="1rem" styleClass="mb-0"></p-skeleton>
          </div>
          <div class="job-posting-stats">
            <p-skeleton width="80px" height="1rem" styleClass="mb-0"></p-skeleton>
            <p-skeleton width="80px" height="1rem" styleClass="mb-0"></p-skeleton>
            <p-skeleton width="120px" height="1rem" styleClass="mb-0"></p-skeleton>
          </div>
        </div>
        <div class="job-posting-actions">
          <div class="status-control">
            <p-skeleton width="60px" height="1rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="100%" height="2.5rem" styleClass="mb-0"></p-skeleton>
          </div>
          <div class="action-buttons">
            <p-skeleton width="100%" height="2.5rem" styleClass="mb-2"></p-skeleton>
            <p-skeleton width="100%" height="2.5rem" styleClass="mb-0"></p-skeleton>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Empty State -->
    @if (!loading() && visibleJobs().length === 0) {
    <div class="tab-content">
      <div class="empty">
        <p>لا توجد وظائف في هذه الفئة.</p>
        <a [routerLink]="['/companies/post-job']" class="btn btn-primary">نشر وظيفة جديدة</a>
      </div>
    </div>
    }

    <!-- Jobs List -->
    @if (!loading() && visibleJobs().length > 0) {
    <div class="tab-content">
      @for (j of visibleJobs(); track j.id) {
      <div class="job-posting-item">
        <div class="job-posting-info">
          <div class="job-header">
            <h4 class="job-posting-title">
              <a [routerLink]="['/companies/post-job']" [queryParams]="{ edit: j.slug }" class="job-title-link">
                {{ j.title }}
              </a>
            </h4>
            <span class="job-status-badge" [ngClass]="'status-' + getJobStatus(j)">
              @if (getJobStatus(j) === 'active') {
              <span class="badge-icon">✓</span>
              <span>نشطة</span>
              } @else if (getJobStatus(j) === 'paused') {
              <span class="badge-icon">⏸</span>
              <span>متوقفة</span>
              } @else {
              <span class="badge-icon">✕</span>
              <span>مغلقة</span>
              }
            </span>
          </div>
          <div class="job-posting-meta">
            <span class="meta-item">
              <span class="meta-icon"><i class="pi pi-calendar"></i></span>
              <span>نُشرت في {{ j.created_at | date:'yyyy/MM/dd' }}</span>
            </span>
            <span class="meta-item">
              <span class="meta-icon"><i class="pi pi-map-marker"></i></span>
              <span>{{ j.city || '—' }}</span>
            </span>
            <span class="meta-item">
              <span class="meta-icon"><i class="pi pi-money-bill"></i></span>
              <span>{{ salaryText(j) }}</span>
            </span>
          </div>
          <div class="job-posting-stats">
            <span class="stat-item stat-applicants">
              <span class="stat-icon"><i class="pi pi-users"></i></span>
              <span class="stat-value">{{ j.applications_count || 0 }}</span>
              <span class="stat-label">متقدم</span>
            </span>
            <span class="stat-item stat-views">
              <span class="stat-icon"><i class="pi pi-eye"></i></span>
              <span class="stat-value">{{ j.views_count || 0 }}</span>
              <span class="stat-label">مشاهدة</span>
            </span>
            @if (j.category) {
            <span class="stat-item stat-category">
              <span class="stat-icon"><i class="pi pi-tag"></i></span>
              <span class="stat-label">{{ j.category.name }}</span>
            </span>
            }
          </div>
        </div>
        <div class="job-posting-actions">
          <div class="status-control">
            <label for="status-{{ j.id }}" class="status-label">
              <span class="label-icon">⚙️</span>
              الحالة:
            </label>
            <select id="status-{{ j.id }}" class="status-select" [value]="getJobStatus(j)" [disabled]="isUpdating(j.id)"
              (change)="updateJobStatus(j, $any($event.target).value)" title="تغيير حالة الوظيفة">
              <option value="active">نشطة</option>
              <option value="paused">متوقفة</option>
              <option value="closed">مغلقة</option>
            </select>
            @if (isUpdating(j.id)) {
            <span class="updating-indicator">
              <span class="spinner">⏳</span>
              جاري التحديث...
            </span>
            }
          </div>
          <div class="action-buttons">
            <a [routerLink]="['/companies/applicants-for-job']" [queryParams]="{ job: j.slug }"
              class="btn-action btn-view-applicants">
              <span class="btn-icon"><i class="pi pi-users"></i></span>
              <span>عرض المتقدمين</span>
            </a>
            <a [routerLink]="['/companies/post-job']" [queryParams]="{ edit: j.slug }" class="btn-action btn-edit">
              <span class="btn-icon"><i class="pi pi-pencil"></i></span>
              <span>تحرير</span>
            </a>
          </div>
        </div>
      </div>
      }
    </div>
    }

    <!-- Pagination -->
    @if (!loading() && totalPages() > 1) {
    <div class="pagination-wrapper">
      <p-paginator [rows]="page_size()" [totalRecords]="totalCount()" [first]="(currentPage() - 1) * page_size()"
        [rowsPerPageOptions]="[5, 10, 20, 50]" (onPageChange)="onPageChange($event)" [showFirstLastIcon]="true"
        [showPageLinks]="true" appendTo="body" [alwaysShow]="true">
      </p-paginator>
      <div class="pagination-info">
        <p>عرض {{ ((currentPage() - 1) * page_size()) + 1 }} - {{ Math.min(currentPage() * page_size(), totalCount()) }}
          من {{ totalCount() }} وظيفة</p>
      </div>
    </div>
    }
  </div>
</div>