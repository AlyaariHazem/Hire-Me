<!-- English: Render only when jobDetail is loaded -->
<section class="job-details-section" *ngIf="jobDetail as job">
  <div class="container">
    <div class="job-details-container">
      <!-- Main Content -->
      <main class="job-main-content">
        <!-- Job Header -->
        <div class="job-header">
          <div class="job-header-top">
            <img
              class="company-logo-large"
              [src]="job.company.logo || 'images/company-logo-1.jpg'"
              [alt]="job.company.name || 'ุดุนุงุฑ ุงูุดุฑูุฉ'"
            />

            <div style="flex-grow: 1">
              <h1 class="job-title-large">{{ job.title }}</h1>
              <p class="company-name-large">{{ job.company.name }}</p>

              <div class="job-meta-large">
                <div class="meta-item">
                  <span class="meta-icon">๐</span>
                  <span>
                    {{ job.city || job.company.city || 'ุบูุฑ ูุญุฏุฏ' }}ุ
                    {{ job.company.country || 'ุบูุฑ ูุญุฏุฏ' }}
                  </span>
                </div>

                <div class="meta-item">
                  <span class="meta-icon">๐ฐ</span>
                  <span>
                    {{ formatSalary(job.salary_min, job.salary_max) }}
                  </span>
                </div>

                <div class="meta-item">
                  <span class="meta-icon">โฐ</span>
                  <span>{{ getJobTypeLabel(job.job_type) }}</span>
                </div>

                <div class="meta-item">
                  <span class="meta-icon">๐</span>
                  <span>
                    ููุดุฑุช ูู {{ job.created_at | date: 'mediumDate' }}
                  </span>
                </div>

                <div class="meta-item">
                  <span class="meta-icon">๐ฅ</span>
                  <span>{{ job.applications_count || 0 }} ูุชูุฏู</span>
                </div>

                <div class="meta-item">
                  <span class="meta-icon">๐๏ธ</span>
                  <span>{{ job.views_count || 0 }} ูุดุงูุฏุฉ</span>
                </div>
              </div>
            </div>
          </div>

          <div class="job-actions-large">
            <button
              type="button"
              class="btn btn-large btn-primary"
              (click)="toggleApplicationForm()"
            >
              ุชูุฏูู ุงูุขู
            </button>

            <button
              type="button"
              class="btn btn-large btn-secondary save-btn"
              (click)="onSaveJob()"
            >
              {{ job.is_bookmarked ? 'ุฅุฒุงูุฉ ูู ุงููุญููุธุงุช' : 'ุญูุธ ุงููุธููุฉ' }}
            </button>

            <button
              type="button"
              class="btn btn-large btn-secondary"
              (click)="onShareJob()"
            >
              ูุดุงุฑูุฉ
            </button>
          </div>
        </div>

        <!-- Application Form -->
        <div class="application-form" *ngIf="showApplicationForm">
          <h3 style="margin-bottom: 1rem">ุชูุฏูู ุทูุจ ูููุธููุฉ</h3>
          <form>
            <div class="form-row">
              <div class="field-group">
                <label class="field-label">ุงูุงุณู ุงููุงูู</label>
                <input type="text" class="form-input" required />
              </div>
              <div class="field-group">
                <label class="field-label">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                <input type="email" class="form-input" required />
              </div>
            </div>

            <div class="form-row">
              <div class="field-group">
                <label class="field-label">ุฑูู ุงููุงุชู</label>
                <input type="tel" class="form-input" required />
              </div>
              <div class="field-group">
                <label class="field-label">ุณููุงุช ุงูุฎุจุฑุฉ</label>
                <select class="form-select" required>
                  <option value="">ุงุฎุชุฑ ุณููุงุช ุงูุฎุจุฑุฉ</option>
                  <option value="0-1">ุฃูู ูู ุณูุฉ</option>
                  <option value="1-3">1-3 ุณููุงุช</option>
                  <option value="3-5">3-5 ุณููุงุช</option>
                  <option value="5+">ุฃูุซุฑ ูู 5 ุณููุงุช</option>
                </select>
              </div>
            </div>

            <div class="field-group">
              <label class="field-label">ุฑูุน ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ</label>

              <!-- English: hidden file input with template ref -->
              <input
                #cvUpload
                type="file"
                id="cv-upload"
                accept=".pdf,.doc,.docx"
                style="display: none"
              />

              <!-- English: clicking this div triggers input.click() via the template ref -->
              <div class="file-upload" (click)="cvUpload.click()">
                <p>ุงููุฑ ููุง ูุฑูุน ุงูุณูุฑุฉ ุงูุฐุงุชูุฉ</p>
                <p style="font-size: var(--font-size-sm); color: var(--gray-500)">
                  PDF, DOC, DOCX (ุญุฏ ุฃูุตู 5MB)
                </p>
              </div>
            </div>

            <div class="field-group">
              <label class="field-label">ุฎุทุงุจ ุงูุชุบุทูุฉ (ุงุฎุชูุงุฑู)</label>
              <textarea
                class="form-input"
                rows="4"
                placeholder="ุงูุชุจ ุฎุทุงุจ ุชุบุทูุฉ ูุฎุชุตุฑ ููุถุญ ุณุจุจ ุงูุชูุงูู ุจูุฐู ุงููุธููุฉ..."
              ></textarea>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end">
              <button type="button" class="btn btn-secondary" (click)="toggleApplicationForm()">
                ุฅูุบุงุก
              </button>
              <button type="submit" class="btn btn-primary" (click)="onApply()">
                ุฅุฑุณุงู ุงูุทูุจ
              </button>
            </div>
          </form>
        </div>

        <!-- Job Description -->
        <div class="content-section" *ngIf="job.description">
          <h2 class="section-title">ูุตู ุงููุธููุฉ</h2>
          <div class="content-text">
            <p>{{ job.description }}</p>
          </div>
        </div>

        <!-- Requirements -->
        <div class="content-section" *ngIf="job.requirements">
          <h2 class="section-title">ุงููุชุทูุจุงุช ูุงููุคููุงุช</h2>
          <div class="content-text">
            <!-- English: Split by newline if backend stores multi-line text -->
            <ul class="requirements-list">
              <li *ngFor="let item of job.requirements.split('\n')">
                {{ item }}
              </li>
            </ul>
          </div>
        </div>

        <!-- Responsibilities -->
        <div class="content-section" *ngIf="job.responsibilities">
          <h2 class="section-title">ุงููุณุคูููุงุช ุงููุธูููุฉ</h2>
          <div class="content-text">
            <ul class="requirements-list">
              <li *ngFor="let item of job.responsibilities.split('\n')">
                {{ item }}
              </li>
            </ul>
          </div>
        </div>

        <!-- Benefits -->
        <div class="content-section" *ngIf="job.benefits">
          <h2 class="section-title">ุงููุฒุงูุง ูุงูุญูุงูุฒ</h2>
          <div class="content-text">
            <ul class="benefits-list">
              <li *ngFor="let item of job.benefits.split('\n')">
                {{ item }}
              </li>
            </ul>
          </div>
        </div>

        <!-- Company About (fallback to company description) -->
        <div class="content-section" *ngIf="job.company.description">
          <h2 class="section-title">ุนู ุงูุดุฑูุฉ</h2>
          <div class="content-text">
            <p>{{ job.company.description }}</p>
          </div>
        </div>
      </main>

      <!-- Sidebar -->
      <aside class="job-sidebar">
        <!-- Job Details Card -->
        <div class="sidebar-card">
          <h3 class="sidebar-title">ุชูุงุตูู ุงููุธููุฉ</h3>
          <ul class="job-details-list">
            <li>
              <span class="detail-label">ููุน ุงููุธููุฉ</span>
              <span class="detail-value">{{ getJobTypeLabel(job.job_type) }}</span>
            </li>

            <li>
              <span class="detail-label">ูุณุชูู ุงูุฎุจุฑุฉ</span>
              <span class="detail-value">{{ getExperienceLevelLabel(job.experience_level) }}</span>
            </li>

            <li>
              <span class="detail-label">ุงูุฑุงุชุจ</span>
              <span class="detail-value">{{ formatSalary(job.salary_min, job.salary_max) }}</span>
            </li>

            <li>
              <span class="detail-label">ุงููููุน</span>
              <span class="detail-value">
                {{ job.city || job.company.city || 'ุบูุฑ ูุญุฏุฏ' }}ุ
                {{ job.company.country || 'ุบูุฑ ูุญุฏุฏ' }}
              </span>
            </li>

            <li>
              <span class="detail-label">ุชุงุฑูุฎ ุงููุดุฑ</span>
              <span class="detail-value">{{ job.created_at | date: 'mediumDate' }}</span>
            </li>

            <li *ngIf="job.application_deadline">
              <span class="detail-label">ุขุฎุฑ ููุนุฏ ููุชูุฏูู</span>
              <span class="detail-value">{{ job.application_deadline | date: 'mediumDate' }}</span>
            </li>
          </ul>
        </div>

        <!-- Required Skills -->
        <div class="sidebar-card" *ngIf="job.skills as skills">
          <h3 class="sidebar-title">ุงูููุงุฑุงุช ุงููุทููุจุฉ</h3>
          <div class="skills-list">
            <!-- English: Attempt to split by comma first, fallback to whitespace -->
            <ng-container *ngIf="skills.includes(','); else spaceSplit">
              <span class="skill-tag" *ngFor="let s of skills.split(',')">
                {{ s.trim() }}
              </span>
            </ng-container>
            <ng-template #spaceSplit>
              <span class="skill-tag" *ngFor="let s of skills.split(' ')">
                {{ s.trim() }}
              </span>
            </ng-template>
          </div>
        </div>

        <!-- Company Info Card -->
        <div class="sidebar-card">
          <h3 class="sidebar-title">ูุนูููุงุช ุงูุดุฑูุฉ</h3>
          <div style="text-align: center; margin-bottom: 1rem">
            <img
              [src]="job.company.logo || 'images/company-logo-1.jpg'"
              [alt]="job.company.name || 'ุดุนุงุฑ ุงูุดุฑูุฉ'"
              style="width: 80px; height: 80px; border-radius: var(--radius-lg); object-fit: cover;"
            />
          </div>

          <ul class="job-details-list">
            <li>
              <span class="detail-label">ุงุณู ุงูุดุฑูุฉ</span>
              <span class="detail-value">{{ job.company.name }}</span>
            </li>
            <li *ngIf="job.company.size">
              <span class="detail-label">ุญุฌู ุงูุดุฑูุฉ</span>
              <span class="detail-value">{{ job.company.size }}</span>
            </li>
            <li *ngIf="job.company.industry">
              <span class="detail-label">ุงููุทุงุน</span>
              <span class="detail-value">{{ job.company.industry }}</span>
            </li>
            <li *ngIf="job.company.founded_year">
              <span class="detail-label">ุณูุฉ ุงูุชุฃุณูุณ</span>
              <span class="detail-value">{{ job.company.founded_year }}</span>
            </li>
          </ul>

          <div style="margin-top: 1rem">
            <a
              [routerLink]="['/company', job.company.slug]"
              class="btn btn-secondary"
              style="width: 100%"
            >
              ุนุฑุถ ููู ุงูุดุฑูุฉ
            </a>
          </div>
        </div>

        <!-- Similar Jobs (placeholder) -->
        <!-- English: Keep as placeholder until backend endpoint for similar jobs is integrated -->
        <div class="sidebar-card" *ngIf="false">
          <h3 class="sidebar-title">ูุธุงุฆู ูุดุงุจูุฉ</h3>
          <div class="similar-jobs">
            <!-- English: Dynamic similar jobs list should be rendered here -->
          </div>
        </div>
      </aside>
    </div>
  </div>
</section>

<!-- English: Optional loading fallback if you want it visible before jobDetail exists -->
<section class="job-details-section" *ngIf="!jobDetail && isLoading">
  <div class="container">
    ุฌุงุฑู ุชุญููู ุชูุงุตูู ุงููุธููุฉ...
  </div>
</section>
