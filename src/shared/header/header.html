<header class="header">
  <p-confirmDialog key="logout" [style]="{width: '350px'}" rejectButtonStyleClass="p-button-outlined"></p-confirmDialog>
  <nav class="navbar" [class.mobile-menu-open]="mobileOpen">
    <div class="container">
      <!-- Brand -->
      <div class="navbar-brand">
        <a routerLink="/">
          <img 
            [src]="logoUrl() || 'images/HireMe.png'" 
            alt="منصة التوظيف" 
            class="logo"
            (error)="handleLogoError($event)"
          />
        </a>
      </div>

      <!-- Main nav links (shared) -->
      <ul class="navbar-nav" id="primary-nav" (click)="closeMobileMenu()">
        <!-- Close Button for Mobile Menu - Only show when menu is open -->
        @if (mobileOpen) {
          <li class="nav-item mobile-close-item">
            <button 
              class="mobile-close-btn" 
              type="button"
              (click)="closeMobileMenu()"
              aria-label="إغلاق القائمة"
            >
              <i class="pi pi-times"></i>
              <span>إغلاق</span>
            </button>
          </li>
        }
          <li class="nav-item">
          <a class="nav-link" (click)="routeToJobs()" pRipple>
            <i class="pi pi-briefcase"></i>
            <span class="pr-2">الوظائف</span>
          </a>
        </li>
        <li class="nav-item">
          <a (click)="routeToCompanies()" class="nav-link" pRipple>
            <i class="pi pi-building"></i>
            <span>الشركات</span>
          </a>
        </li>
        <li class="nav-item">
          <a (click)="notImplemented()" class="nav-link" pRipple>
            <i class="pi pi-dollar"></i>
            <span>الرواتب</span>
          </a>
        </li>
        <li class="nav-item">
          <a (click)="notImplemented()" class="nav-link" pRipple>
            <i class="pi pi-book"></i>
            <span>الموارد</span>
          </a>
        </li>
        @if (isLoggedIn() && role() === 'jobseeker') {
        <li role="none" (click)="$event.stopPropagation()">
          <p-button
            label="تسجيل الخروج"
            icon="pi pi-sign-out"
            (onClick)="logout()"
            styleClass="p-button-text p-button-danger"
            pRipple
          ></p-button>
        </li>
        }
      </ul>

      <!-- Right side actions (change per mode) -->
      <div class="navbar-actions" dir="rtl" (click)="closeMobileMenu()">
        <!-- ========== Public header (login / register) ========== -->
         @if (!isLoggedIn()) {
            <a routerLink="/login" routerLinkActive="active" [routerLinkActiveOptions]="{exact: false}">
              <p-button 
                label="تسجيل الدخول" 
                icon="pi pi-sign-in"
                styleClass="p-button-outlined"
              ></p-button>
            </a>
            <a routerLink="/register" routerLinkActive="active" [routerLinkActiveOptions]="{exact: false}">
              <p-button 
                label="إنشاء حساب" 
                icon="pi pi-user-plus"
                styleClass="p-button-outlined"
              ></p-button>
            </a>
          }

        <!-- ========== Employer header ========== -->
         @if (isLoggedIn() && role() === 'employer') {
           <div class="navbar-actions company" (click)="$event.stopPropagation()" #menuRoot>
             <div
               class="user-menu"
               *ngIf="isEmployerMenuOpen"
               (click)="$event.stopPropagation()"
             >
               <a class="user-menu-item" (click)="navigate('dashboard')">
                 <i class="pi pi-chart-bar"></i>
                 <span>لوحة التحكم</span>
               </a>
               <a class="user-menu-item" (click)="navigate('profile')">
                 <i class="pi pi-building"></i>
                 <span>ملف الشركة</span>
               </a>
               <a class="user-menu-item" (click)="navigate('user-edit')">
                 <i class="pi pi-user-edit"></i>
                 <span>تعديل الملف الشخصي</span>
               </a>
               <a class="user-menu-item" (click)="navigate('post-job')">
                 <i class="pi pi-plus-circle"></i>
                 <span>نشر وظيفة</span>
               </a>
               <a class="user-menu-item" (click)="navigate('employer-settings')">
                 <i class="pi pi-cog"></i>
                 <span>الإعدادات</span>
               </a>
               <p-divider></p-divider>
               <a class="user-menu-item-logout" (click)="logout()">
                 <i class="pi pi-sign-out"></i>
                 <span>تسجيل الخروج</span>
               </a>
             </div>
             <button
               type="button"
               class="p-button p-button-outlined company-menu-btn"
               (click)="toggleEmployerMenu($event)"
               pRipple
             >
               @if (logoUrl()) {
                 <p-avatar 
                   [image]="logoUrl()" 
                   shape="circle"
                   size="normal"
                   styleClass="company-logo-small-avatar"
                   (onImageError)="handleLogoError($event)"
                 ></p-avatar>
               } @else {
                 <p-avatar 
                   [label]="companyName().charAt(0)"
                   shape="circle"
                   size="normal"
                   styleClass="company-logo-small-avatar"
                 ></p-avatar>
               }
               <span>{{ companyName() }}</span>
               <i class="pi pi-chevron-down"></i>
             </button>
           </div>
         }
      </div>

      <!-- Mobile Menu Toggle -->
      <button
        class="mobile-menu-toggle"
        type="button"
        (click)="toggleMobileMenu()"
        [class.active]="mobileOpen"
        aria-label="فتح القائمة"
        [attr.aria-expanded]="mobileOpen"
        aria-controls="primary-nav"
      >
        <span></span><span></span><span></span>
      </button>
    </div>
  </nav>

  <!-- Backdrop for mobile -->
   @if(mobileOpen){
     <div
       class="mobile-backdrop"
       (click)="closeMobileMenu()"
     ></div>
   }
</header>
